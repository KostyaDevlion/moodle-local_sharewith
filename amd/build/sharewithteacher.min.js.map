{"version":3,"sources":["../src/sharewithteacher.js"],"names":["define","$","Ajax","Notification","modal","SELECTORS","root","STORAGE","resultBlock","tagWrapper","input","numOfSings","init","addEventListener","e","target","contains","dataset","handler","addTag","removeTag","submitTeachers","shareActivity","parentNode","bind","autocompleteTeachers","cmid","attr","courseid","getCurrentCourse","self","call","methodname","args","activityid","done","renderPopup","response","context","JSON","parse","render","template","shareteacher","document","querySelector","triggerBtn","click","fail","exception","keySelect","container","currentItem","items","Array","from","children","forEach","item","tabIndex","onmouseover","focus","index","onfocus","setBlur","blur","setFocus","goUp","goDown","length","selectItem","event","Event","bubbles","dispatchEvent","hideAll","innerHTML","classList","add","removeEventListener","closeBlockResult","keyCodeHandler","keyCode","path","indexOf","showSearchResult","teachers","teacher","unit","createElement","teacherid","id","teachername","teacher_name","M","cfg","wwwroot","teacher_url","remove","appendChild","inputValue","value","childElementCount","searchstring","myForm","modalWrapper","formData","FormData","isValidData","addBtnSpinner","teachersid","stringify","getAll","message","get","error","title","util","get_string","text","status","confirm","tag","find","teacherTag","clone","append","removeClass","errors","push","el","popover","on","str","result","match","replace"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript controller for the \"Actions\" panel at the bottom of the page.\n *\n * @module     local_sharewith/buildtree\n * @package    local_sharewith\n * @copyright  2018 Devlion <info@devlion.co>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since      3.6\n */\n\ndefine([\n    'jquery',\n    'core/ajax',\n    'core/notification',\n    'local_sharewith/modal',\n], function($, Ajax, Notification, modal) {\n\n    var SELECTORS = {\n        root: 'body',\n    };\n\n    var STORAGE = {};\n\n    /** @alias module:local_sharewith/sharewithteacher */\n    return {\n\n        resultBlock: '',\n        tagWrapper: '',\n        input: '',\n        numOfSings: 3,\n\n        init: function() {\n\n            var root = $(SELECTORS.root)[0];\n            root.addEventListener('click', function(e) {\n                var target = e.target;\n                while (root.contains(target)) {\n                    switch (target.dataset.handler) {\n                        case 'addTag':\n                            this.addTag(target);\n                            break;\n                        case 'removeTag':\n                            this.removeTag(target);\n                            break;\n                        case 'sendLinkToTeachers':\n                            this.submitTeachers();\n                            break;\n                        case 'shareActivity':\n                            this.shareActivity(target);\n                            break;\n                    }\n                    target = target.parentNode;\n                }\n            }.bind(this));\n\n            root.addEventListener('input', function(e) {\n                var target = e.target;\n                while (root.contains(target)) {\n                    switch (target.dataset.handler) {\n                        case 'selectTeacher':\n                            this.autocompleteTeachers(target);\n                            break;\n                    }\n                    target = target.parentNode;\n                }\n            }.bind(this));\n\n        },\n\n        /**\n         * Choose a teacher for copying the activity.\n         *\n         * @method shareActivity\n         * @param {Node} target element.\n         */\n        shareActivity: function(target) {\n            STORAGE.cmid = $(target).attr('data-cmid');\n            STORAGE.courseid = this.getCurrentCourse();\n            var self = this;\n            var renderPopup = function(response) {\n                var context = JSON.parse(response);\n                modal.render(modal.template.shareteacher, context)\n                    .done(function() {\n                        self.resultBlock = document.querySelector('.result-block');\n                        self.tagWrapper = document.querySelector('.tag-wrapper');\n                        self.input = document.querySelector('input[data-handler = \"selectTeacher\"]');\n                        modal.triggerBtn.click();\n                    });\n            };\n\n            Ajax.call([{\n                methodname: 'local_sharewith_get_teachers',\n                args: {\n                    activityid: Number(STORAGE.cmid),\n                    courseid: Number(STORAGE.courseid)\n                },\n                done: renderPopup,\n                fail: Notification.exception\n            }]);\n        },\n\n        keySelect: function(container) {\n\n            var currentItem = 0;\n            var tagWrapper = document.querySelector('.tag-wrapper');\n            var items = Array.from(container.children);\n            items.forEach(function(item) {\n                item.tabIndex = 0;\n            });\n\n            container.onmouseover = function(e) {\n                e.target.focus();\n                items.forEach(function(item, index) {\n                    item.onfocus = function() {\n                        currentItem = index;\n                    };\n                });\n            };\n\n            var setBlur = function() {\n                items[currentItem].blur();\n            };\n            var setFocus = function() {\n                items[currentItem].focus();\n            };\n\n            var goUp = function() {\n                if (currentItem <= 0) {\n                    return;\n                } else {\n                    setBlur();\n                    currentItem--;\n                    setFocus();\n                }\n            };\n            var goDown = function() {\n                if (currentItem >= items.length - 1) {\n                    return;\n                } else {\n                    setBlur();\n                    currentItem++;\n                    setFocus();\n                }\n            };\n            var selectItem = function() {\n                var event = new Event('click', {bubbles: true});\n                items[currentItem].dispatchEvent(event);\n\n            };\n            var hideAll = function() {\n                container.innerHTML = '';\n                container.classList.add('d-none');\n                currentItem = -1;\n                document.removeEventListener('click', closeBlockResult);\n                document.removeEventListener('keydown', keyCodeHandler);\n            };\n\n            var keyCodeHandler = function(e) {\n                switch (e.keyCode) {\n                    case 38: // Arrow up.\n                        goUp();\n                        break;\n                    case 40: // Arrow down.\n                        goDown();\n                        break;\n                    case 13: // Enter.\n                        selectItem();\n                        break;\n                    case 27: // Esc.\n                        hideAll();\n                        break;\n                }\n            };\n\n            var closeBlockResult = function(e) {\n                if (container.contains(e.target) || e.path.indexOf(tagWrapper) != -1) {\n                    return;\n                }\n                hideAll();\n            };\n\n            document.addEventListener('click', closeBlockResult);\n            document.addEventListener('keydown', keyCodeHandler);\n        },\n\n        showSearchResult: function(response) {\n            this.resultBlock.innerHTML = '';\n            var teachers = JSON.parse(response);\n\n            teachers.forEach(function(teacher) {\n                var unit = document.createElement('li');\n                unit.dataset.teacherid = teacher.id;\n                unit.dataset.teachername = teacher.teacher_name;\n                unit.dataset.handler = 'addTag';\n                unit.classList.add('btn', 'btn-secondary', 'd-flex', 'mb-1');\n                unit.innerHTML = '<div class = \"sw-img\" >' +\n                    '<img src = \"' + M.cfg.wwwroot + teacher.teacher_url + '\" alt = \"\">' +\n                    '</div><span class = \"pl-2\">' + teacher.teacher_name + '</span>';\n                if (this.tagWrapper.querySelector('.btn[data-id=\"' + teacher.id + '\"]')) {\n                    unit.classList.add('active');\n                }\n                this.resultBlock.classList.remove('d-none');\n                this.resultBlock.appendChild(unit);\n            }.bind(this));\n\n            this.keySelect(this.resultBlock);\n        },\n\n        autocompleteTeachers: function(target) {\n            var inputValue = target.value;\n\n            if (!this.resultBlock.childElementCount && !inputValue) {\n                this.resultBlock.classList.add('d-none');\n            }\n\n            if (inputValue.length >= this.numOfSings) {\n                Ajax.call([{\n                    methodname: 'local_sharewith_autocomplete_teachers',\n                    args: {\n                        searchstring: inputValue\n                    },\n                    done: this.showSearchResult.bind(this),\n                    fail: Notification.exception\n                }]);\n            }\n        },\n\n        submitTeachers: function() {\n            var myForm = modal.modalWrapper.querySelector('form');\n            var formData = new FormData(myForm);\n\n            if (!this.isValidData(formData)) {\n                return;\n            }\n            modal.addBtnSpinner();\n\n            var renderPopup = function(response) {\n                var template = modal.template.error;\n                var context = {\n                    title: M.util.get_string('eventcopytoteacher', 'local_sharewith'),\n                    text: M.util.get_string('system_error_contact_administrator', 'local_sharewith'),\n                };\n                if (!response.status) {\n                    context.text = response.message;\n                } else {\n                    template = modal.template.confirm;\n                    context.text = M.util.get_string('succesfullyshared', 'local_sharewith');\n                }\n                modal.render(template, context);\n            };\n\n            Ajax.call([{\n                methodname: 'local_sharewith_submit_teachers',\n                args: {\n                    activityid: STORAGE.cmid,\n                    courseid: STORAGE.courseid,\n                    teachersid: JSON.stringify(formData.getAll('teacherid')),\n                    message: formData.get('message')\n                },\n                done: renderPopup,\n                fail: Notification.exception\n            }]);\n\n        },\n\n        addTag: function(target) {\n            var teacherid = target.dataset.teacherid,\n                tag = $(this.tagWrapper).find('[data-teacherid=' + teacherid + ']');\n\n            if (tag.length) {\n                this.removeTag(tag[0]);\n                return;\n            }\n\n            var teacherTag = $(this.tagWrapper).find('.example').clone();\n            $(teacherTag).attr('data-teacherid', teacherid);\n            $(teacherTag)\n              .find('input')\n              .attr('value', teacherid)\n              .attr('checked', 'checked');\n            teacherTag.append('<span>' + target.dataset.teachername + '</span>');\n            teacherTag.removeClass('example d-none');\n\n            target.classList.add('active');\n            $(this.tagWrapper).append(teacherTag);\n            this.input.value = '';\n        },\n\n        removeTag: function(target) {\n            var teacherid = target.dataset.teacherid;\n            $(this.resultBlock).find('[data-teacherid=' + teacherid + ']')\n                .removeClass('active');\n            $(target).remove();\n        },\n\n        isValidData: function(formData) {\n            var errors = [];\n            if (!formData.getAll('teacherid').length) {\n                errors.push($('#selectteacher'));\n            }\n\n            errors.forEach(function(el) {\n                $(el).popover({\n                    template: '<div class=\"popover\" role=\"tooltip\">' +\n                    '<div class=\"arrow\"></div>' +\n                    '<div class=\"popover-body text-danger\" style=\"font-size:1rem;\"></div>' +\n                    '</div>'\n                });\n                $(el).popover('show');\n                $(el).on('click remove', function() {\n                    $(this).popover('hide');\n                });\n            });\n\n            return errors.length ? false : true;\n        },\n        /**\n         * Get current course on which the system is located.\n         *\n         * @method getCurrentCourse\n         * @param {string} handler name of the handler.\n         * @return {int} id number of the course.\n         */\n        getCurrentCourse: function() {\n            var str = $('body').attr('class'),\n                result = str.match(/course-\\d+/gi)[0].replace(/\\D+/, '');\n            return result;\n        },\n    };\n});\n"],"file":"sharewithteacher.min.js"}