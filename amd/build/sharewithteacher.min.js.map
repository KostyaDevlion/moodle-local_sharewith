{"version":3,"sources":["../src/sharewithteacher.js"],"names":["define","$","Ajax","Notification","modal","resultBlock","tagWrapper","input","numOfSings","init","root","modalWrapper","addEventListener","e","target","contains","dataset","handler","addTag","removeTag","submitTeachers","shareActivity","parentNode","bind","autocompleteTeachers","cmid","modalContent","attr","self","call","methodname","args","activityid","courseid","getCurrentCourse","done","renderPopup","response","context","JSON","parse","render","template","shareteacher","document","querySelector","fail","exception","keySelect","container","currentItem","items","Array","from","children","forEach","item","tabIndex","onmouseover","focus","index","onfocus","setBlur","blur","setFocus","goUp","goDown","length","selectItem","event","Event","bubbles","dispatchEvent","hideAll","innerHTML","classList","add","removeEventListener","closeBlockResult","keyCodeHandler","keyCode","path","indexOf","showSearchResult","teachers","teacher","unit","createElement","teacherid","teacher_id","teachername","teacher_name","M","cfg","wwwroot","teacher_url","remove","appendChild","inputValue","value","childElementCount","searchstring","chosenBlocks","find","teachersId","each","push","isValidData","addBtnSpinner","activityId","courseId","message","val","teachersid","stringify","error","title","util","get_string","text","confirm","tag","teacherTag","clone","append","removeClass","data","errors","el","popover","on","str","result","match","replace"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript controller for the \"Actions\" panel at the bottom of the page.\n *\n * @module     local_sharewith/buildtree\n * @package    local_sharewith\n * @copyright  2018 Devlion <info@devlion.co>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since      3.6\n */\n\ndefine([\n    'jquery',\n    'core/ajax',\n    'core/notification',\n    'local_sharewith/modal',\n], function($, Ajax, Notification, modal) {\n\n    /** @alias module:local_sharewith/sharewithteacher */\n    return {\n\n      resultBlock: '',\n      tagWrapper: '',\n      input: '',\n      numOfSings: 3,\n\n      init: function() {\n\n          var root = modal.modalWrapper;\n          root.addEventListener('click', function(e) {\n              var target = e.target;\n              while (root.contains(target)) {\n                  switch (target.dataset.handler) {\n                      case 'addTag':\n                      this.addTag(target);\n                      break;\n                      case 'removeTag':\n                      this.removeTag(target);\n                      break;\n                      case 'sendLinkToTeachers':\n                      this.submitTeachers();\n                      break;\n                      case 'shareActivity':\n                      this.shareActivity();\n                      break;\n                  }\n                  target = target.parentNode;\n              }\n          }.bind(this));\n\n          root.addEventListener('input', function(e) {\n              var target = e.target;\n              while (root.contains(target)) {\n                  switch (target.dataset.handler) {\n                      case 'selectTeacher':\n                      this.autocompleteTeachers(target);\n                      break;\n                  }\n                  target = target.parentNode;\n              }\n          }.bind(this));\n\n      },\n      /**\n       * Choose a teacher for copying the activity.\n       *\n       * @method shareActivity\n       * @param {Node} target element.\n       */\n      shareActivity: function() {\n          var cmid = $(modal.modalContent).attr('data-cmid');\n          var self = this;\n          var renderPopup = function(response) {\n              var context = JSON.parse(response);\n              modal.render(modal.template.shareteacher, context)\n                  .done(function() {\n                      self.resultBlock = document.querySelector('.result-block');\n                      self.tagWrapper = document.querySelector('.tag-wrapper');\n                      self.input = document.querySelector('input[data-handler = \"selectTeacher\"]');\n                  });\n          };\n\n          Ajax.call([{\n              methodname: 'local_sharewith_get_teachers',\n              args: {\n                  activityid: Number(cmid),\n                  courseid: Number(this.getCurrentCourse())\n              },\n              done: renderPopup,\n              fail: Notification.exception\n          }]);\n      },\n\n      keySelect: function(container) {\n\n          var currentItem = 0;\n          var tagWrapper = document.querySelector('.tag-wrapper');\n          var items = Array.from(container.children);\n          items.forEach(function(item) {\n              item.tabIndex = 0;\n          });\n\n          container.onmouseover = function(e) {\n              e.target.focus();\n              items.forEach(function(item, index) {\n                  item.onfocus = function() {\n                      currentItem = index;\n                  };\n              });\n          };\n\n          var setBlur = function() {\n              items[currentItem].blur();\n          };\n          var setFocus = function() {\n              items[currentItem].focus();\n          };\n\n          var goUp = function() {\n              if (currentItem <= 0) {\n                  return;\n              } else {\n                  setBlur();\n                  currentItem--;\n                  setFocus();\n              }\n          };\n          var goDown = function() {\n              if (currentItem >= items.length - 1) {\n                  return;\n              } else {\n                  setBlur();\n                  currentItem++;\n                  setFocus();\n              }\n          };\n          var selectItem = function() {\n              var event = new Event('click', {bubbles: true});\n              items[currentItem].dispatchEvent(event);\n\n          };\n          var hideAll = function() {\n              container.innerHTML = '';\n              container.classList.add('d-none');\n              currentItem = -1;\n              document.removeEventListener('click', closeBlockResult);\n              document.removeEventListener('keydown', keyCodeHandler);\n          };\n\n          var keyCodeHandler = function(e) {\n              switch (e.keyCode) {\n                  case 38: // Arrow up.\n                      goUp();\n                      break;\n                  case 40: // Arrow down.\n                      goDown();\n                      break;\n                  case 13: // Enter.\n                      selectItem();\n                      break;\n                  case 27: // Esc.\n                      hideAll();\n                      break;\n              }\n          };\n\n          var closeBlockResult = function(e) {\n              if (container.contains(e.target) || e.path.indexOf(tagWrapper) != -1) {\n                  return;\n              }\n              hideAll();\n          };\n\n          document.addEventListener('click', closeBlockResult);\n          document.addEventListener('keydown', keyCodeHandler);\n      },\n\n      showSearchResult: function(response) {\n          this.resultBlock.innerHTML = '';\n          var teachers = JSON.parse(response);\n\n          teachers.forEach(function(teacher) {\n              var unit = document.createElement('li');\n              unit.dataset.teacherid = teacher.teacher_id;\n              unit.dataset.teachername = teacher.teacher_name;\n              unit.dataset.handler = 'addTag';\n              unit.classList.add('btn', 'btn-secondary', 'd-flex', 'mb-1');\n              unit.innerHTML = '<div class = \"sw-img\" >' +\n                  '<img src = \"' + M.cfg.wwwroot + teacher.teacher_url + '\" alt = \"\">' +\n                  '</div><span class = \"pl-2\">' + teacher.teacher_name + '</span>';\n              if (this.tagWrapper.querySelector('.btn[data-id=\"' + teacher.teacher_id + '\"]')) {\n                  unit.classList.add('active');\n              }\n              this.resultBlock.classList.remove('d-none');\n              this.resultBlock.appendChild(unit);\n          }.bind(this));\n\n          this.keySelect(this.resultBlock);\n      },\n\n      autocompleteTeachers: function(target) {\n          var inputValue = target.value;\n\n          if (!this.resultBlock.childElementCount && !inputValue) {\n              this.resultBlock.classList.add('d-none');\n          }\n\n          if (inputValue.length >= this.numOfSings) {\n              Ajax.call([{\n                  methodname: 'local_sharewith_autocomplete_teachers',\n                  args: {\n                      searchstring: inputValue\n                  },\n                  done: this.showSearchResult.bind(this),\n                  fail: Notification.exception\n              }]);\n          }\n      },\n\n      submitTeachers: function() {\n          var chosenBlocks = $(this.tagWrapper).find('.btn:not(.example)');\n          var teachersId = [];\n\n          chosenBlocks.each(function() {\n              teachersId.push($(this).attr('data-teacherid'));\n          });\n\n          if (!this.isValidData(teachersId)) {\n              return;\n          }\n          modal.addBtnSpinner();\n          var activityId = $(modal.modalContent).attr('data-cmid');\n          var courseId = this.getCurrentCourse();\n          var message = $(\"#message_for_teacher\").val();\n\n          var renderPopup = function(response) {\n              var template = modal.template.error;\n              var context = {\n                  title: M.util.get_string('eventcopytoteacher', 'local_sharewith'),\n                  text: M.util.get_string('system_error_contact_administrator', 'local_sharewith'),\n              };\n              if (response) {\n                  template = modal.template.confirm;\n                  context.text = M.util.get_string('succesfullyshared', 'local_sharewith');\n              }\n\n              modal.render(template, context);\n          };\n\n          Ajax.call([{\n              methodname: 'local_sharewith_submit_teachers',\n              args: {\n                  activityid: activityId,\n                  courseid: courseId,\n                  teachersid: JSON.stringify(teachersId),\n                  message: message\n              },\n              done: renderPopup,\n              fail: Notification.exception\n          }]);\n\n      },\n\n      addTag: function(target) {\n          var teacherid = target.dataset.teacherid,\n              tag = $(this.tagWrapper).find('[data-teacherid=' + teacherid + ']');\n\n          if (tag.length) {\n              this.removeTag(tag[0]);\n              return;\n          }\n\n          var teacherTag = $(this.tagWrapper).find('.example').clone();\n          teacherTag.attr('data-teacherid', teacherid);\n          teacherTag.append('<span>' + target.dataset.teachername + '</span>');\n          teacherTag.removeClass('example d-none');\n\n          target.classList.add('active');\n          $(this.tagWrapper).append(teacherTag);\n          this.input.value = '';\n      },\n\n      removeTag: function(target) {\n          var teacherid = target.dataset.teacherid;\n          $(this.resultBlock).find('[data-teacherid=' + teacherid + ']')\n              .removeClass('active');\n          $(target).remove();\n      },\n\n      isValidData: function(data) {\n        var errors = [];\n        // No teacher selected\n        if (!data.length) {\n            errors.push($('#selectteacher'));\n        }\n\n        // Show tooltips error per element\n        errors.forEach(function(el) {\n            $(el).popover({\n              template: '<div class=\"popover\" role=\"tooltip\">' +\n                            '<div class=\"arrow\"></div>' +\n                            '<div class=\"popover-body text-danger\" style=\"font-size:1rem;\"></div>' +\n                        '</div>'\n            });\n            $(el).popover('show');\n            $(el).on('click remove', function() {\n                $(this).popover('hide');\n            });\n        });\n\n        return errors.length ? false : true;\n      },\n      /**\n       * Get current course on which the system is located.\n       *\n       * @method getCurrentCourse\n       * @param {string} handler name of the handler.\n       * @return {int} id number of the course.\n       */\n      getCurrentCourse: function() {\n          var str = $('body').attr('class'),\n              result = str.match(/course-\\d+/gi)[0].replace(/\\D+/, '');\n          return result;\n      },\n    };\n});\n"],"file":"sharewithteacher.min.js"}