{"version":3,"sources":["../src/modal.js"],"names":["define","$","Templates","Notification","SELECTORS","modalWrapper","modalContent","triggerBtn","editMenu","actionMenu","actionBlock","menuSection","template","modalwrapper","selector","copyinstance","error","confirm","shareteacher","uploadactivity","actions","modalInit","addShareButtonEditMenu","activitysending","string","M","util","get_string","menu","document","find","each","clone","children","last","text","attr","removeAttr","addClass","append","addShareButtonActivity","shareBtn","insertAfter","addCopySectionButton","insertTemplates","self","render","done","html","js","appendNodeContents","querySelector","fail","exception","context","replaceNodeContents","addActionNode","sectioncopy","activitycopy","addBtnSpinner","removeClass","parent","prop","goBack"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript controller for the \"Actions\" panel at the bottom of the page.\n *\n * @module     local_sharewith/modal\n * @package    local_sharewith\n * @copyright  2018 Devlion <info@devlion.co>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since      3.6\n */\n\ndefine([\n    'jquery',\n    'core/templates',\n    'core/notification'\n], function($, Templates, Notification) {\n\n    var SELECTORS = {\n        modalWrapper: '#modalSharewith',\n        modalContent: '#modalContentSharewith',\n        triggerBtn: '#triggerModalSharewith',\n        editMenu: '.course-content li.activity [role=\"menu\"]',\n        actionMenu: '.course-content li.activity .actions .action-menu',\n        actionBlock: '.course-content li.activity .actions > div',\n        menuSection: '.course-content .section_action_menu [role=\"menu\"]',\n    };\n\n    return /** @alias module:local_sharewith/modal */ {\n\n        template: {\n            modalwrapper: 'local_sharewith/modalwrapper',\n            selector: 'local_sharewith/selector',\n            copyinstance: 'local_sharewith/copyinstance',\n            error: 'local_sharewith/error',\n            confirm: 'local_sharewith/confirm',\n            shareteacher: 'local_sharewith/shareteacher',\n            uploadactivity: 'local_sharewith/uploadactivity'\n        },\n\n        actions: '',\n\n        modalInit: false,\n\n        triggerBtn: '',\n\n        modalContent: '',\n\n        modalWrapper: '',\n\n        /**\n         * Clone and add the button for copying activity.\n         *\n         * @method addShareButtonEditMenu\n         * @param {boolean} activitysending send activity to teacher.\n         */\n        addShareButtonEditMenu: function(activitysending) {\n\n            var string = M.util.get_string('use_activity', 'local_sharewith'),\n                menu = $(document).find(SELECTORS.editMenu);\n\n            menu.each(function() {\n                var clone = $(this).children().last().clone();\n                clone\n                    .find('.menu-action-text')\n                    .text(string);\n                clone\n                    .attr('href', '#')\n                    .attr('data-handler', 'openShareWith')\n                    .attr('data-activitysending', activitysending)\n                    .removeAttr('data-action')\n                    .addClass('sharingact_item');\n                clone\n                    .find('.icon')\n                    .attr('title', string)\n                    .attr('aria-label', string)\n                    .removeAttr('class')\n                    .addClass('icon fa fa-share-alt fa-fw');\n\n                $(this).append(clone);\n            });\n        },\n\n        /**\n         * Add share button to the activity.\n         *\n         * @method addShareButtonActivity\n         */\n        addShareButtonActivity: function() {\n\n            var menu = $(document).find(SELECTORS.actionMenu),\n                string = M.util.get_string('share', 'local_sharewith');\n\n            menu.each(function() {\n                var shareBtn = $('<button><i class = \"icon\"></i>' + string + '</button>');\n                    shareBtn\n                        .attr('data-handler', 'openShareWith')\n                        .addClass('btn btn-outline-primary btn-sm');\n                    shareBtn\n                        .find('.icon')\n                        .attr('title', string)\n                        .attr('aria-label', string)\n                        .addClass('fa fa-share-alt fa-fw');\n                shareBtn.insertAfter($(this));\n            });\n        },\n\n        /**\n         * Clone and add the button for copying section.\n         *\n         * @method addCopyActivityButton\n         * @param {jquery} root The root element.\n         */\n        addCopySectionButton: function() {\n\n            var string = M.util.get_string('eventsectioncopy', 'local_sharewith'),\n                menu = $(document).find(SELECTORS.menuSection);\n\n            menu.each(function() {\n                var clone = $(this).children().last().clone();\n                clone\n                    .attr('href', '#')\n                    .attr('data-handler', 'selectCourseForSection');\n                clone\n                    .find('.menu-action-text')\n                    .text(string);\n                clone\n                    .find('.icon')\n                    .removeAttr('class')\n                    .attr('title', string)\n                    .attr('aria-label', string)\n                    .addClass('icon fa fa-copy fa-fw');\n\n                $(this).append(clone);\n            });\n\n        },\n\n        /**\n         * Insert modal markup on the page.\n         *\n         * @method insertTemplates\n         * @return {Promise|boolean}\n         * @param {object} actions Available actions.\n         */\n        insertTemplates: function(actions) {\n            this.actions = actions;\n            var context = {},\n                self = this;\n\n            return Templates.render('local_sharewith/modalwrapper', context)\n              .done(function(html, js) {\n                    if (!self.modalInit) {\n                        Templates.appendNodeContents('body', html, js);\n                        self.modalInit = true;\n                        self.modalWrapper = document.querySelector(SELECTORS.modalWrapper);\n                        self.modalContent = document.querySelector(SELECTORS.modalContent);\n                        self.triggerBtn = document.querySelector(SELECTORS.triggerBtn);\n                    }\n                })\n                .fail(Notification.exception);\n        },\n\n        /**\n         * Insert modal markup on the page.\n         *\n         * @method render\n         * @param {string} template The template name.\n         * @param {object} context The context for template.\n         * @return {Promise}\n         */\n        render: function(template, context) {\n            var self = this;\n            return Templates.render(template, context)\n                    .done(function(html, js) {\n                        Templates.replaceNodeContents(self.modalContent, html, js);\n                    })\n                    .fail(Notification.exception);\n        },\n\n        /**\n         * Add necessary nodes to the DOM.\n         *\n         * @method addActionNode\n         */\n        addActionNode: function() {\n\n\n            if (this.actions.sectioncopy) {\n                this.addCopySectionButton();\n            }\n            if (this.actions.activitycopy) {\n                // Adding share btn to edit menu\n                this.addShareButtonEditMenu(this.actions.activitysending);\n                // Add share button to activity block\n                // this.addShareButtonActivity();\n            }\n\n        },\n\n        /**\n         * Show spinner.\n         *\n         * @method addSpinner\n         */\n        addBtnSpinner: function() {\n            $('#modalspinner').removeClass('d-none');\n            $('#modalspinner').addClass('loading');\n            $('#modalspinner').parent().prop('disabled', true);\n        },\n\n        /**\n         * Return to the main window.\n         *\n         * @method goBack\n         */\n        goBack: function() {\n            var context = {\n                activitysending: Number(this.actions.activitysending)\n            };\n            this.render(this.template.selector, context);\n        },\n    };\n});\n"],"file":"modal.min.js"}