{"version":3,"sources":["../src/modal.js"],"names":["define","$","Templates","Notification","SELECTORS","modalWrapper","modalContent","triggerBtn","actionMenu","actionBlock","menuSection","editMenu","template","modalwrapper","selector","copyinstance","error","confirm","shareteacher","uploadactivity","modalInit","addShareActivityButton","string","M","util","get_string","menu","document","find","each","clone","children","last","cmid","parents","attr","match","replace","text","removeAttr","addClass","append","addCopyActivityButton","addCopySectionButton","insertModalTemplates","self","render","done","html","js","appendNodeContents","querySelector","fail","exception","context","replaceNodeContents","addBtnSpinner","removeClass","parent","prop","goBack","activitysending","actions"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript controller for the \"Actions\" panel at the bottom of the page.\n *\n * @module     local_sharewith/modal\n * @package    local_sharewith\n * @copyright  2018 Devlion <info@devlion.co>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since      3.6\n */\n\ndefine([\n    'jquery',\n    'core/templates',\n    'core/notification'\n], function($, Templates, Notification) {\n\n    var SELECTORS = {\n        modalWrapper: '#modalSharewith',\n        modalContent: '#modalContentSharewith',\n        triggerBtn: '#triggerModalSharewith',\n        actionMenu: '.course-content li.activity .actions .action-menu',\n        actionBlock: '.course-content li.activity .actions > div',\n        menuSection: '.course-content .section_action_menu [role=\"menu\"]',\n        editMenu: '.course-content li.activity [role=\"menu\"]',\n    };\n\n    return /** @alias module:local_sharewith/modal */ {\n\n        template: {\n            modalwrapper: 'local_sharewith/modalwrapper',\n            selector: 'local_sharewith/selector',\n            copyinstance: 'local_sharewith/copyinstance',\n            error: 'local_sharewith/error',\n            confirm: 'local_sharewith/confirm',\n            shareteacher: 'local_sharewith/shareteacher',\n            uploadactivity: 'local_sharewith/uploadactivity'\n        },\n\n        modalInit: false,\n\n        triggerBtn: '',\n\n        modalContent: '',\n\n        modalWrapper: '',\n\n        /**\n         * Clone and add the button for copying activity.\n         *\n         * @method addShareActivityButton\n         * @param {boolean} activitysending send activity to teacher.\n         */\n        addShareActivityButton: function() {\n\n            var string = M.util.get_string('eventcopytoteacher', 'local_sharewith'),\n                menu = $(document).find(SELECTORS.editMenu);\n\n            menu.each(function() {\n                var clone = $(this).children().last().clone(),\n                    cmid = $(this).parents('.activity').attr('id').match(/module-\\d+/gi)[0].replace(/\\D+/, '');\n                clone\n                    .find('.menu-action-text')\n                    .text(string);\n                clone\n                    .attr('href', '#')\n                    .attr('data-handler', 'shareActivity')\n                    .attr('data-cmid', cmid)\n                    .removeAttr('data-action')\n                    .addClass('sharingact_item');\n                clone\n                    .find('.icon')\n                    .attr('title', string)\n                    .attr('aria-label', string)\n                    .removeAttr('class')\n                    .addClass('icon fa fa-share-alt fa-fw');\n\n                $(this).append(clone);\n            });\n        },\n\n        /**\n         * Clone and add the button for copying activity.\n         *\n         * @method addCopyActivityButton\n         * @param {boolean} activitysending send activity to teacher.\n         */\n        addCopyActivityButton: function() {\n\n            var string = M.util.get_string('eventactivitycopy', 'local_sharewith'),\n                menu = $(document).find(SELECTORS.editMenu);\n\n            menu.each(function() {\n                var clone = $(this).children().last().clone(),\n                    cmid = $(this).parents('.activity').attr('id').match(/module-\\d+/gi)[0].replace(/\\D+/, '');\n                clone\n                    .find('.menu-action-text')\n                    .text(string);\n                clone\n                    .attr('href', '#')\n                    .attr('data-handler', 'selectCourse')\n                    .attr('data-cmid', cmid)\n                    .removeAttr('data-action')\n                    .addClass('sharingact_item');\n                clone\n                    .find('.icon')\n                    .attr('title', string)\n                    .attr('aria-label', string)\n                    .removeAttr('class')\n                    .addClass('icon fa fa-copy fa-fw');\n\n                $(this).append(clone);\n            });\n        },\n\n        /**\n         * Clone and add the button for copying section.\n         *\n         * @method addCopyActivityButton\n         * @param {jquery} root The root element.\n         */\n        addCopySectionButton: function() {\n\n            var string = M.util.get_string('eventsectioncopy', 'local_sharewith'),\n                menu = $(document).find(SELECTORS.menuSection);\n\n            menu.each(function() {\n                var clone = $(this).children().last().clone();\n                clone\n                    .attr('href', '#')\n                    .attr('data-handler', 'selectCourseForSection');\n                clone\n                    .find('.menu-action-text')\n                    .text(string);\n                clone\n                    .find('.icon')\n                    .removeAttr('class')\n                    .attr('title', string)\n                    .attr('aria-label', string)\n                    .addClass('icon fa fa-copy fa-fw');\n\n                $(this).append(clone);\n            });\n        },\n\n        /**\n         * Insert modal markup on the page.\n         *\n         * @method insertModalTemplates\n         * @return {Promise|boolean}\n\n         */\n        insertModalTemplates: function() {\n            var context = {},\n                self = this;\n\n            return Templates.render('local_sharewith/modalwrapper', context)\n                .done(function(html, js) {\n                    if (!self.modalInit) {\n                        Templates.appendNodeContents('body', html, js);\n                        self.modalInit = true;\n                        self.modalWrapper = document.querySelector(SELECTORS.modalWrapper);\n                        self.modalContent = document.querySelector(SELECTORS.modalContent);\n                        self.triggerBtn = document.querySelector(SELECTORS.triggerBtn);\n                    }\n                })\n                .fail(Notification.exception);\n        },\n\n        /**\n         * Insert modal markup on the page.\n         *\n         * @method render\n         * @param {string} template The template name.\n         * @param {object} context The context for template.\n         * @return {Promise}\n         */\n        render: function(template, context) {\n            var self = this;\n            return Templates.render(template, context)\n                .done(function(html, js) {\n                    Templates.replaceNodeContents(self.modalContent, html, js);\n                })\n                .fail(Notification.exception);\n        },\n\n        /**\n         * Show spinner.\n         *\n         * @method addSpinner\n         */\n        addBtnSpinner: function() {\n            $('#modalspinner').removeClass('d-none');\n            $('#modalspinner').addClass('loading');\n            $('#modalspinner').parent().prop('disabled', true);\n        },\n\n        /**\n         * Return to the main window.\n         *\n         * @method goBack\n         */\n        goBack: function() {\n            var context = {\n                activitysending: Number(this.actions.activitysending)\n            };\n            this.render(this.template.selector, context);\n        },\n    };\n});\n"],"file":"modal.min.js"}