{"version":3,"sources":["../src/copyinstance.js"],"names":["define","$","Str","Ajax","Notification","modal","STORAGE","init","root","document","querySelector","addEventListener","e","target","contains","classList","selectCategory","dataset","handler","selectCourseForSection","copySectionToCourse","openShareWith","selectCourse","selectSection","copyActivityToCourse","copyCourseToCategory","parentNode","bind","typeMessage","sectionid","parents","find","data","call","methodname","args","done","renderPopup","response","context","copySection","courses","JSON","parse","render","template","copyinstance","triggerBtn","click","fail","exception","modalContent","courseid","addBtnSpinner","sourcecourseid","getCurrentCourse","sourcesectionid","type","error","title","M","util","get_string","text","result","confirm","self","copyActivity","cmid","hidebackbtn","attr","sections","html","forEach","section","append","section_id","section_name","sourceactivityid","copyCourse","categories","categoryid","urlString","window","location","href","url","URL","param","searchParams","get","textarea","activityname","message","i","typeWriter","length","innerHTML","charAt","setTimeout","val","value","focus","str","match","replace"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript controller for the \"Actions\" panel at the bottom of the page.\n *\n * @module     local_sharewith/copyactivity\n * @package    local_sharewith\n * @copyright  2018 Devlion <info@devlion.co>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since      3.6\n */\n\ndefine([\n    'jquery',\n    'core/str',\n    'core/ajax',\n    'core/notification',\n    'local_sharewith/modal',\n\n], function($, Str, Ajax, Notification, modal) {\n\n    var STORAGE = {};\n\n    return /** @alias module:local_sharewith/copyInstance */ {\n\n        init: function() {\n            var root = document.querySelector('body');\n\n            root.addEventListener('click', function(e) {\n                var target = e.target;\n                while (root.contains(target)) {\n\n                    if (target.classList.contains('selectCategory')) {\n                        this.selectCategory();\n                        return;\n                    }\n\n                    switch (target.dataset.handler) {\n                        case 'selectCourseForSection':\n                            this.selectCourseForSection(target);\n                            break;\n                        case 'copySectionToCourse':\n                            this.copySectionToCourse();\n                            break;\n                        case 'openShareWith':\n                            this.openShareWith(target);\n                            break;\n                        case 'selectCourse':\n                            this.selectCourse(target);\n                            break;\n                        case 'selectSection':\n                            this.selectSection();\n                            break;\n                        case 'copyActivityToCourse':\n                            this.copyActivityToCourse();\n                            break;\n                        case 'copyCourseToCategory':\n                            this.copyCourseToCategory();\n                            break;\n                    }\n                    target = target.parentNode;\n                }\n            }.bind(this));\n\n            this.typeMessage();\n        },\n\n        selectCourseForSection: function(target) {\n            var sectionid = $(target).parents('.section').find('[data-itemtype=\"sectionname\"]').data('itemid');\n\n            STORAGE.sectionid = sectionid;\n            var renderPopup = function(response) {\n                var context = {\n                    copySection: true,\n                    courses: JSON.parse(response.courses)\n                };\n                modal.render(modal.template.copyinstance, context)\n                    .done(modal.triggerBtn.click());\n            };\n\n            Ajax.call([{\n                methodname: 'local_sharewith_get_courses',\n                args: {},\n                done: renderPopup,\n                fail: Notification.exception\n            }]);\n        },\n\n        /**\n         * Copy section to selected course.\n         *\n         * @method copySectionToCourse\n         */\n        copySectionToCourse: function() {\n            var modalContent = $(modal.modalContent),\n                courseid = modalContent.find(':selected').data('courseid');\n\n            modal.addBtnSpinner();\n            var renderPopup = function(response) {\n                var template = modal.template.error;\n                var context = {\n                    title: M.util.get_string('eventsectioncopy', 'local_sharewith'),\n                    text: M.util.get_string('system_error_contact_administrator', 'local_sharewith'),\n                };\n                if (response.result) {\n                    template = modal.template.confirm;\n                    context = {\n                        title: M.util.get_string('eventsectioncopy', 'local_sharewith'),\n                        text: M.util.get_string('section_copied_to_course', 'local_sharewith'),\n                    };\n                }\n                modal.render(template, context);\n            };\n\n            Ajax.call([{\n                methodname: 'local_sharewith_add_sharewith_task',\n                args: {\n                    courseid: Number(courseid),\n                    sourcecourseid: Number(this.getCurrentCourse()),\n                    sourcesectionid: Number(STORAGE.sectionid),\n                    type: 'sectioncopy'\n                },\n                done: renderPopup,\n                fail: Notification.exception\n            }]);\n        },\n\n        /**\n         * Choose a course for copying the activity.\n         *\n         * @method selectCourse\n         * @param {Node} target element.\n         */\n        selectCourse: function(target) {\n            var self = this;\n\n            var renderPopup = function(response) {\n                var context = {\n                    courses: JSON.parse(response.courses),\n                    copyActivity: true\n                };\n\n                STORAGE.cmid = target.dataset.cmid;\n                context.hidebackbtn = true;\n                modal.render(modal.template.copyinstance, context)\n                    .done(modal.triggerBtn.click())\n                    .done(self.selectSection);\n\n            };\n\n            Ajax.call([{\n                methodname: 'local_sharewith_get_courses',\n                args: {},\n                done: renderPopup,\n                fail: Notification.exception\n            }]);\n        },\n\n        /**\n         * Choose a section for copying the activity.\n         *\n         * @method selectSection\n         */\n        selectSection: function() {\n            var modalContent = $(modal.modalContent),\n                courseid = modalContent.find(':selected').attr('data-courseid');\n\n            if (!courseid) {\n                courseid = this.getCurrentCourse();\n            }\n\n            var renderPopup = function(response) {\n                var sections = JSON.parse(response.sections);\n                modalContent.find('.sections').html('');\n                sections.forEach(function(section) {\n                    modalContent.find('.sections')\n                        .append($('<option data-sectionid =' + section.section_id + '>' + section.section_name + '</option>'));\n                });\n            };\n\n            Ajax.call([{\n                methodname: 'local_sharewith_get_sections',\n                args: {\n                    courseid: Number(courseid)\n                },\n                done: renderPopup,\n                fail: Notification.exception\n            }]);\n        },\n\n        /**\n         * Copy activity to selected course.\n         *\n         * @method copyActivityToCourse\n         */\n\n        copyActivityToCourse: function() {\n            var modalContent = $(modal.modalContent),\n                courseid = modalContent.find('.courses option:selected').attr('data-courseid'),\n                sectionid = modalContent.find('.sections option:selected').attr('data-sectionid');\n            modal.addBtnSpinner();\n            var renderPopup = function(response) {\n                var context = {\n                    title: M.util.get_string('eventdublicatetoteacher', 'local_sharewith'),\n                };\n                var template = modal.template.error;\n\n                switch (response.result) {\n                    case 0:\n                        context.text = M.util.get_string('system_error_contact_administrator', 'local_sharewith');\n                        break;\n                    case 1:\n                        context.text = M.util.get_string('error_coursecopy', 'local_sharewith');\n                        break;\n                    case 2:\n                        context.text = M.util.get_string('error_sectioncopy', 'local_sharewith');\n                        break;\n                    case 3:\n                        context.text = M.util.get_string('error_activitycopy', 'local_sharewith');\n                        break;\n                    case 4:\n                        context.text = M.util.get_string('error_permission_allow_copy', 'local_sharewith');\n                        break;\n                    case 10:\n                        context.text = M.util.get_string('activity_copied_to_course', 'local_sharewith');\n                        template = modal.template.confirm;\n                        break;\n                }\n                modal.render(template, context);\n            };\n\n            Ajax.call([{\n                methodname: 'local_sharewith_add_sharewith_task',\n                args: {\n                    courseid: Number(courseid),\n                    sourcecourseid: Number(this.getCurrentCourse()),\n                    sectionid: Number(sectionid),\n                    sourceactivityid: Number(STORAGE.cmid),\n                    type: 'activitycopy'\n                },\n                done: renderPopup,\n                fail: Notification.exception\n            }]);\n        },\n\n        /**\n         * Choose a category for copying the course.\n         *\n         * @method selectCategory\n         */\n        selectCategory: function() {\n\n            var renderPopup = function(response) {\n                var context = {\n                    hidebackbtn: true,\n                    copyCourse: true,\n                    categories: JSON.parse(response.categories)\n                };\n                var template = modal.template.copyinstance;\n                if (!response.result) {\n                    context = {\n                        hidebackbtn: true,\n                        copyCourse: true,\n                        title: M.util.get_string('eventcoursecopy', 'local_sharewith'),\n                        text: M.util.get_string('no_accessible_category', 'local_sharewith')\n                    };\n                    template = modal.template.error;\n                }\n\n                modal.render(template, context)\n                    .done(modal.triggerBtn.click());\n            };\n\n            Ajax.call([{\n                methodname: 'local_sharewith_get_categories',\n                args: {},\n                done: renderPopup,\n                fail: Notification.exception\n            }]);\n        },\n\n        /**\n         * Copy course to selected categories.\n         *\n         * @method copyCourseToCategory\n         */\n        copyCourseToCategory: function() {\n            var categoryid = $(modal.modalContent).find(':selected').attr('data-categoryid');\n\n            var renderPopup = function(response) {\n                var context = {\n                    title: M.util.get_string('eventcoursecopy', 'local_sharewith'),\n                    text: M.util.get_string('system_error_contact_administrator', 'local_sharewith')\n                },\n                    template = modal.template.error;\n                if (response.result) {\n                    context = {\n                        title: M.util.get_string('eventcoursecopy', 'local_sharewith'),\n                        text: M.util.get_string('course_copied_to_section', 'local_sharewith'),\n                    };\n                    template = modal.template.confirm;\n                }\n                modal.render(template, context);\n            };\n\n            Ajax.call([{\n                methodname: 'local_sharewith_add_sharewith_task',\n                args: {\n                    sourcecourseid: Number(this.getCurrentCourse()),\n                    categoryid: Number(categoryid),\n                    type: 'coursecopy'\n                },\n                done: renderPopup,\n                fail: Notification.exception\n            }]);\n        },\n\n        typeMessage: function() {\n            var urlString = window.location.href;\n            var url = new URL(urlString);\n            var param = url.searchParams.get('swactivityname');\n            if (param) {\n                var textarea = $('textarea[data-region=\"send-message-txt\"]')[0];\n                var speed = 30;\n                /* The speed/duration of the effect in milliseconds */\n                var data = {activityname: param};\n                Str.get_string('ask_question_before_copying', 'local_sharewith', data).done(function(message) {\n                    var i = 0;\n                    (function typeWriter() {\n                        if (i < message.length) {\n                            textarea.innerHTML += message.charAt(i);\n                            i++;\n                            setTimeout(typeWriter, speed);\n                        } else {\n                            var val = textarea.value;\n                            $(textarea)\n                              .focus()\n                              .val(\"\")\n                              .val(val);\n                        }\n                    })();\n                }).fail(Notification.exception);\n            }\n        },\n\n        /**\n         * Get current course on which the system is located.\n         *\n         * @method getCurrentCourse\n         * @param {string} handler name of the handler.\n         * @return {int} id number of the course.\n         */\n        getCurrentCourse: function() {\n            var str = $('body').attr('class'),\n                result = str.match(/course-\\d+/gi)[0].replace(/\\D+/, '');\n            return result;\n        },\n    };\n});\n"],"file":"copyinstance.min.js"}