{"version":3,"sources":["../src/copyinstance.js"],"names":["define","$","Str","Ajax","Notification","modal","init","root","document","querySelector","addEventListener","e","target","contains","classList","selectCategory","dataset","handler","selectCourseForSection","copySectionToCourse","openShareWith","selectCourse","selectSection","copyActivityToCourse","copyCourseToCategory","parentNode","bind","typeMessage","sectionid","parents","find","data","modalContent","attr","call","methodname","args","done","renderPopup","response","context","copySection","courses","JSON","parse","render","template","copyinstance","triggerBtn","click","fail","exception","courseid","addBtnSpinner","sourcecourseid","getCurrentCourse","sourcesectionid","type","error","title","M","util","get_string","text","result","confirm","cmid","activitysending","selector","self","copyActivity","activitysharing","hidebackbtn","sections","html","forEach","section","append","section_id","section_name","sourceactivityid","copyCourse","categories","categoryid","urlString","window","location","href","url","URL","param","searchParams","get","input","activityname","message","i","typeWriter","length","innerHTML","charAt","setTimeout","focus","str","match","replace"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript controller for the \"Actions\" panel at the bottom of the page.\n *\n * @module     local_sharewith/copyactivity\n * @package    local_sharewith\n * @copyright  2018 Devlion <info@devlion.co>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since      3.6\n */\n\ndefine([\n    'jquery',\n    'core/str',\n    'core/ajax',\n    'core/notification',\n    'local_sharewith/modal',\n\n], function($, Str, Ajax, Notification, modal) {\n\n    return /** @alias module:local_sharewith/copyInstance */ {\n\n        init: function() {\n            var root = document.querySelector('body');\n\n            root.addEventListener('click', function(e) {\n                var target = e.target;\n                while (root.contains(target)) {\n\n                    if (target.classList.contains('selectCategory')) {\n                        this.selectCategory();\n                        return;\n                    }\n\n                    switch (target.dataset.handler) {\n                        // Copy Section to course.\n                        case 'selectCourseForSection':\n                            this.selectCourseForSection(target);\n                            break;\n                        case 'copySectionToCourse':\n                            this.copySectionToCourse();\n                            break;\n                        // Copy Acitvity.\n                        case 'openShareWith':\n                            this.openShareWith(target);\n                            break;\n                        case 'selectCourse':\n                            this.selectCourse(target);\n                            break;\n                        case 'selectSection':\n                            this.selectSection();\n                            break;\n                        case 'copyActivityToCourse':\n                            this.copyActivityToCourse();\n                            break;\n                        // Copy Course to category.\n                        case 'copyCourseToCategory':\n                            this.copyCourseToCategory();\n                            break;\n                    }\n                    target = target.parentNode;\n                }\n            }.bind(this));\n\n            this.typeMessage();\n        },\n\n        selectCourseForSection: function(target) {\n            var sectionid = $(target).parents('.section').find('[data-itemtype=\"sectionname\"]').data('itemid');\n\n            $(modal.modalContent).attr('data-sectionid', sectionid);\n            var renderPopup = function(response) {\n                var context = {\n                    copySection: true,\n                    courses: JSON.parse(response.courses)\n                };\n                modal.render(modal.template.copyinstance, context)\n                    .done(modal.triggerBtn.click());\n            };\n\n            Ajax.call([{\n              methodname: 'local_sharewith_get_courses',\n              args: {},\n              done: renderPopup,\n              fail: Notification.exception\n            }]);\n        },\n\n        /**\n         * Copy section to selected course.\n         *\n         * @method copySectionToCourse\n         */\n        copySectionToCourse: function() {\n            var modalContent = $(modal.modalContent),\n                sectionid = modalContent.attr('data-sectionid'),\n                courseid = modalContent.find(':selected').data('courseid');\n\n            modal.addBtnSpinner();\n            var renderPopup = function(response) {\n                var template = modal.template.error,\n                    context = {\n                        title: M.util.get_string('eventsectioncopy', 'local_sharewith'),\n                        text: M.util.get_string('system_error_contact_administrator', 'local_sharewith'),\n                    };\n                if (response.result) {\n                    template = modal.template.confirm;\n                    context = {\n                        title: M.util.get_string('eventsectioncopy', 'local_sharewith'),\n                        text: M.util.get_string('section_copied_to_course', 'local_sharewith'),\n                    };\n                }\n                modal.render(template, context);\n            };\n\n            Ajax.call([{\n                methodname: 'local_sharewith_add_sharewith_task',\n                args: {\n                    courseid: Number(courseid),\n                    sourcecourseid: Number(this.getCurrentCourse()),\n                    sourcesectionid: Number(sectionid),\n                    type: 'sectioncopy'\n                },\n                done: renderPopup,\n                fail: Notification.exception\n            }]);\n        },\n\n        openShareWith: function(target) {\n          var cmid = $(target).parents('.activity').find('[data-itemtype=\"activityname\"]').data('itemid'),\n              sectionid = $(target).parents('.section').find('[data-itemtype=\"sectionname\"]').data('itemid'),\n              context = {\n                  activitysending: Number(target.dataset.activitysending)\n              },\n              template = modal.template.selector;\n\n          $(modal.modalContent)\n              .attr('data-cmid', cmid)\n              .attr('data-sectionid', sectionid);\n\n          modal.render(template, context)\n              .done(modal.triggerBtn.click());\n        },\n\n        /**\n         * Choose a course for copying the activity.\n         *\n         * @method selectCourse\n         * @param {Node} target element.\n         */\n        selectCourse: function(target) {\n            var self = this;\n\n            var renderPopup = function(response) {\n                var context = {\n                    courses: JSON.parse(response.courses),\n                    copyActivity: true\n                };\n                if (target.dataset.activitysharing) {\n                    var cmid = target.dataset.activitysharing;\n                    $(modal.modalContent).attr('data-cmid', cmid);\n                    context.hidebackbtn = true;\n                    modal.render(modal.template.copyinstance, context)\n                        .done(modal.triggerBtn.click())\n                        .done(self.selectSection);\n                } else {\n                    modal.render(modal.template.copyinstance, context)\n                        .done(self.selectSection);\n                }\n            };\n\n            Ajax.call([{\n                methodname: 'local_sharewith_get_courses',\n                args: {},\n                done: renderPopup,\n                fail: Notification.exception\n            }]);\n        },\n\n        /**\n         * Choose a section for copying the activity.\n         *\n         * @method selectSection\n         */\n        selectSection: function() {\n            var modalContent = $(modal.modalContent),\n                courseid = modalContent.find(':selected').attr('data-courseid');\n\n            if (!courseid) {\n                courseid = this.getCurrentCourse();\n            }\n\n            var renderPopup = function(response) {\n                var sections = JSON.parse(response.sections);\n                modalContent.find('.sections').html('');\n                sections.forEach(function(section) {\n                    modalContent.find('.sections')\n                        .append($('<option data-sectionid =' + section.section_id + '>' + section.section_name + '</option>'));\n                });\n            };\n\n            Ajax.call([{\n                methodname: 'local_sharewith_get_sections',\n                args: {\n                    courseid: Number(courseid)\n                },\n                done: renderPopup,\n                fail: Notification.exception\n            }]);\n        },\n\n        /**\n         * Copy activity to selected course.\n         *\n         * @method copyActivityToCourse\n         */\n\n        copyActivityToCourse: function() {\n            var modalContent = $(modal.modalContent),\n                cmid = modalContent.attr('data-cmid'),\n                courseid = modalContent.find('.courses option:selected').attr('data-courseid'),\n                sectionid = modalContent.find('.sections option:selected').attr('data-sectionid');\n            modal.addBtnSpinner();\n            var renderPopup = function(response) {\n                var context = {\n                    title: M.util.get_string('eventdublicatetoteacher', 'local_sharewith'),\n                };\n                var template = modal.template.error;\n\n                switch (response.result) {\n                    case 0:\n                    context.text = M.util.get_string('system_error_contact_administrator', 'local_sharewith');\n                    break;\n                    case 1:\n                    context.text = M.util.get_string('error_coursecopy', 'local_sharewith');\n                    break;\n                    case 2:\n                    context.text = M.util.get_string('error_sectioncopy', 'local_sharewith');\n                    break;\n                    case 3:\n                    context.text = M.util.get_string('error_activitycopy', 'local_sharewith');\n                    break;\n                    case 4:\n                    context.text = M.util.get_string('error_permission_allow_copy', 'local_sharewith');\n                    break;\n                    case 10:\n                    context.text = M.util.get_string('activity_copied_to_course', 'local_sharewith');\n                    template = modal.template.confirm;\n                    break;\n                }\n                modal.render(template, context);\n            };\n\n            Ajax.call([{\n                methodname: 'local_sharewith_add_sharewith_task',\n                args: {\n                    courseid: Number(courseid),\n                    sourcecourseid: Number(this.getCurrentCourse()),\n                    sectionid: Number(sectionid),\n                    sourceactivityid: Number(cmid),\n                    type: 'activitycopy'\n                },\n                done: renderPopup,\n                fail: Notification.exception\n            }]);\n        },\n\n        /**\n         * Choose a category for copying the course.\n         *\n         * @method selectCategory\n         */\n        selectCategory: function() {\n\n            var renderPopup = function(response) {\n                var context = {\n                    hidebackbtn: true,\n                    copyCourse: true,\n                    categories: JSON.parse(response.categories)\n                };\n                var template = modal.template.copyinstance;\n                if (!response.result) {\n                    context = {\n                        hidebackbtn: true,\n                        copyCourse: true,\n                        title:  M.util.get_string('eventcoursecopy', 'local_sharewith'),\n                        text: M.util.get_string('no_accessible_category', 'local_sharewith')\n                    };\n                    template = modal.template.error;\n                }\n\n                modal.render(template, context)\n                    .done(modal.triggerBtn.click());\n            };\n\n            Ajax.call([{\n                methodname: 'local_sharewith_get_categories',\n                args: {},\n                done: renderPopup,\n                fail: Notification.exception\n            }]);\n        },\n\n        /**\n         * Copy course to selected categories.\n         *\n         * @method copyCourseToCategory\n         */\n        copyCourseToCategory: function() {\n            var categoryid = $(modal.modalContent).find(':selected').attr('data-categoryid');\n\n            var renderPopup = function(response) {\n                var context = {\n                    title: M.util.get_string('eventcoursecopy', 'local_sharewith'),\n                    text: M.util.get_string('system_error_contact_administrator', 'local_sharewith'),\n                },\n                template = modal.template.error;\n              if (response.result) {\n                  context = {\n                      title: M.util.get_string('eventcoursecopy', 'local_sharewith'),\n                      text: M.util.get_string('course_copied_to_section', 'local_sharewith'),\n                  };\n                  template = modal.template.confirm;\n              }\n              modal.render(template, context);\n            };\n\n            Ajax.call([{\n                methodname: 'local_sharewith_add_sharewith_task',\n                args: {\n                    sourcecourseid: Number(this.getCurrentCourse()),\n                    categoryid: Number(categoryid),\n                    type: 'coursecopy'\n                },\n                done: renderPopup,\n                fail: Notification.exception\n            }]);\n        },\n\n        typeMessage: function() {\n          var urlString = window.location.href;\n          var url = new URL(urlString);\n          var param = url.searchParams.get('swactivityname');\n          if (param) {\n              var input = document.querySelector('textarea[data-region=\"send-message-txt\"]');\n              var speed = 30; /* The speed/duration of the effect in milliseconds */\n              var data = {activityname: param};\n              Str.get_string('ask_question_before_copying', 'local_sharewith', data).done(function(message) {\n                  var i = 0;\n                  (function typeWriter() {\n                    if (i < message.length) {\n                      input.innerHTML += message.charAt(i);\n                      i++;\n                      setTimeout(typeWriter, speed);\n                    } else {\n                        input.focus();\n                      }\n                  })();\n              }).fail(Notification.exception);\n          }\n        },\n\n        /**\n         * Get current course on which the system is located.\n         *\n         * @method getCurrentCourse\n         * @param {string} handler name of the handler.\n         * @return {int} id number of the course.\n         */\n        getCurrentCourse: function() {\n            var str = $('body').attr('class'),\n                result = str.match(/course-\\d+/gi)[0].replace(/\\D+/, '');\n            return result;\n        },\n    };\n});\n"],"file":"copyinstance.min.js"}